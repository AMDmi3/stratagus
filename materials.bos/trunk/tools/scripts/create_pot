# to be executed from the bos root directory

# create a temporary directory
mkdir -p tmp
# copy the scripts to that directory
cp -r scripts tmp/
# change into it and only work here
cd tmp
# find all lua scripts and replace the lua comments by python comments
find scripts \( -name .svn -prune \) -o -name "*.lua" -exec bash -c "sed \"{}\" -e 's/--/#/g' > \"{}.new\"" \;
# move the new files over the old files (in the temporary dir)
find scripts \( -type d -name .svn -prune \) -o -type d -exec mmv -od "{}/*.lua.new" "{}/#1.lua" \;
find scripts -name "*.lua.new" -exec rm "{}" \;
# create the new pot file by adding the entries of all lua scripts to it
# using xgettext
touch bos.pot
find scripts \( -name .svn -prune \) -o -type d -exec bash -c 'xgettext -j -F -o bos.pot -L Python --from-code=UTF-8 --copyright-holder="BOS" -k_ {}/*.lua' \;
sed -e 's/SOME DESCRIPTIVE TITLE/BOS Bos Wars translation template/g' \
    -e 's/Copyright (C) YEAR BOS/Copyright (C) YEAR BOS, but note that this file was automatically generated/g' \
    -e "s/YEAR/`date|awk '{print $6}'`/g" \
    -e 's/same license as the PACKAGE package/GPL, see the README/g' \
    -e 's/CHARSET/UTF-8/g' \
  bos.pot > bos.pot.tmp
mv bos.pot.tmp bos.pot
# copy the result to the final destination
cp bos.pot ../languages/bos.pot.new
cd ..
# remove the temporary directory
rm -rf tmp
