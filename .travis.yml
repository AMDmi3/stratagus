language: cpp
os:
  - linux
  - osx
addons:
  apt:
    packages:
      - cmake
      - libsdl1.2-dev
      - liblua5.1-0-dev
      - libtolua++5.1-dev
      - libtolua-dev
      - zlib1g-dev
      - libpng12-dev
env:
  global:
    secure: h/wMVlWxfXeIC35xML0omciLC92zEVxwubWphmmF0dti90CwfEESV/Xo3cC6BH5rNUkxWctELGlBlkUEaP5Tyy/yjfkYv+dvR0Vh7H+M2ZZttDyIOv1016iz/3tNC7elMKyt2e3VHzVajGiHXMKNf+l0DO2/3T3YiKDlZIydb5IDbgaKIY4vPBkc05khAEpWEeNc2dpYxNTh6zgTCuBdc4INbKzDhgivimrXoYRTZ6tBcpvjy/iVy9gFJShwR0neM/F7b80wgyp02Cc5Z7Cwx0APc/UZ9uEd0aWzunO2wjFc9KPppOmlydnfXrzD8SUXg33X9sMLH7hpUXuom1lFlzpofXyH6nZ3wHZX+9jX6liiHRpBlSG+T3V4ddVjWZo1HHKmTMlu0x9S4uw1xSwWmX4dWPQaIGO0/BRKZwV00UdXlnUm+s5e7k6NPu1iI6Amuc4CCUC54PGPBRY8OA6A04krq2RB2Rx+xMuWmECJ3mFPVjW48XUkZvcQxexoocRxCWWRMGX5qKF4/TSbzMRMrLsUqcOCc9zW+uJoMQ404sKnjwUZp9fOfoZuVHSrHJ4SNW8tPYu4XCrTbURVgeePB3QqrwYiLZBDQ8F9eFMU/Gwdc2uJRp3+fLhyGu+x896jryJnpEmbs1P2sUvKjZnlmE3XxDv5xCvLNFhbRrl0Pfo=
before_script:
  - "if [ $TRAVIS_OS_NAME == osx ]; then brew install lua51 sdl; \
         git clone https://github.com/LuaDist/toluapp.git; \
         cd toluapp; mkdir build;
           cd build; cmake ..; make; \
             export CMAKEARGS=\"-DTOLUA++_INCLUDE_DIR=$(pwd)/../include/ -DTOLUA++_LIBRARY=$(pwd)/libtoluapp.dylib -DTOLUA++_APP=$(pwd)/toluapp -DWITH_X11=OFF\";
           cd ..;
         cd ..;
    fi"
  - mkdir build
  - cd build
  - cmake $CMAKEARGS ..
script: make
after_success:
  - "if [ $TRAVIS_REPO_SLUG == Wargus/stratagus -a \
          $TRAVIS_BRANCH == master -a \
          $TRAVIS_OS_NAME == osx -a \
          $TRAVIS_PULL_REQUEST == 'false' ]; then \
         git clone https://${GH_TOKEN}@github.com/Wargus/stratagus.wiki.git;
         mkdir -p stratagus.wiki/$TRAVIS_OS_NAME;
         cp $TRAVIS_BUILD_DIR/build/stratagus stratagus.wiki/$TRAVIS_OS_NAME/;
         rm -rf macdylibbundler; git clone https://github.com/auriamg/macdylibbundler;
         cd macdylibbundler; make; cd ..;
         macdylibbundler/dylibbundler -cd -of -b -x stratagus.wiki/$TRAVIS_OS_NAME/stratagus -d stratagus.wiki/libs/;
         cd stratagus.wiki/;
         git config --global user.email \"travis-ci@travis.org\";
         git config --global user.name \"Travis CI\";
         git add $TRAVIS_OS_NAME/stratagus;
         git add libs;
         git commit --amend -C HEAD;
         git push -fq origin master;
         cd ..;
    fi"
deploy:
  provider: launchpad
  slug: "~stratagus/stratagus/github-master"
  oauth_token:
    secure: "CX6MZNpQEEy3+f8b4zch2ETHMI7rTvd9EIjrw6w97jZUC+lTTzqvAlk3HLLf70CwTZnf5h4B2XL/lHKYxq3OC0chMzEx26A6XCP3VmgerpDiYKo5XVzsC8wpWl6kwJBPrBbBrZroSEG6D0w9p1vz4Fob7VFDoY3ZKVntdoE+UXgM/cHtg1L4yTNUPPXGso1vLM8YOYfVj8lMQr7bn9R1VkHV52exjbGPHgVa9kbmFc2Ub4js22XqqNQs4eSnE23FAzqKjMb5eV+saFo8AQ2kaV/tueNyYDQfi/QFfTvoT/JHU6/T2wwLJbmEhWurerZO0OwzSEnng7sA4zH15yN7x+yAp742h8W+tlC7WBjKVG1c1aAbLomHhQb46Nw+Z4/3mj8RYOhSxBVEVh/dbq6gAJ7Yu0XDlJ/IDDE3uZfEACNt7FKyqRVYw1JUx5aWGbI/zlVAnsrQ4nAPtulwiATl1/KujmY8HzkwVrvDl7hhSjdxS4hKWDq0ivowjl7IdFbMbDcw4QFqissG37loNFZatRntbvv6D+s+fFSpCcZaYV5QMnpgORWLOJkPQzjoBSiumVxicunGOwhBbWsn1Z8Rova+tCn+lQ1pOLnNjKHTf0DRrqrKBBePQUkUGOzj0UYWP9wmnZ5DAykIFtD7Cr/ACWAvcY1mnncsEY95EhTBxP0="
  oauth_token_secret:
    secure: "kFO1pZnzRZwpOLfVrFH+LeAPX03nrGs+JSaYkVbPtrvcJJJMHESGBCHFrx1JY8OvL6s5aPOhbC5mXuDevigtMnWHJrNdY8QeRHtSnTcFh2rGiWSot1rVtnQMnldY15uZXipMT/ceksfXoA4vxViS0/LWstNkKNY2Y+jjTbphy0053pTBLFRk2cwASneCfFWXnjanrSoloBdSITYgLTM8CjMxIjvdZAo79IYtoVsb1FbjK88hdnuPKN+O+L0MqkzGLJQirR32IDFnNG7lQ9JQoDC7mspL0W3WJOb3pEd8Uiw32kJx/FlZ/QRxdg76pakh4AcdEPGfAerbBUK6T1kPvZgWe4R+VHydQtvayA3AzRX7zrXfWKlvOXQGTEnuDHf5JG7G529N9KYkCGfCvcioKtzRkvj5CM+LEjbLE66gLhb5eBKCrAp+Gqu5HDkQ7vRm7hDB0bnN9/frpJ9y0inxP/oITNKuJUHOayx1967IFyekn9WsVcQm1MA5qNGipiAVIudkRkT/X30KivecXcHq7UPOeyxZlla3z3NIvx+bo5Hd00MRJtanyDdLCHl/sJfE/p7NUi7gkQZ/ip1iTf59nVhuz8pu6aE/xur50T7icxOUk/sSpjIRwuXxeC7vovKGkV1Tjpx3ZK9ozw9RIWRSTlmnY4Z3L96amTp+zqPmuDE="
